// Copyright 2020-2021 Beken
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

#include <driver/int.h>
#include <os/mem.h>
#include <driver/gpio.h>
#include <driver/gpio_types.h>
#include <driver/jpeg_enc.h>
#include <driver/jpeg_enc_types.h>
#include <driver/dvp_camera.h>
#include <driver/dvp_camera_types.h>

#include <driver/i2c.h>

#include "dvp_sensor_devices.h"

#define GC0329_WRITE_ADDRESS (0x62)
#define GC0329_READ_ADDRESS (0x63)
#define GC0329_CHIP_ID (0x62)
#define FLIP_INIT_GC0329 (0x14)

#define TAG "gc0329"
#define LOGI(...) BK_LOGI(TAG, ##__VA_ARGS__)
#define LOGW(...) BK_LOGW(TAG, ##__VA_ARGS__)

#define SENSOR_I2C_READ(reg, value)                                         \
    do                                                                      \
    {                                                                       \
        dvp_camera_i2c_read_uint8((GC0329_WRITE_ADDRESS >> 1), reg, value); \
    } while (0)

#define SENSOR_I2C_WRITE(reg, value)                                         \
    do                                                                       \
    {                                                                        \
        dvp_camera_i2c_write_uint8((GC0329_WRITE_ADDRESS >> 1), reg, value); \
    } while (0)

bool gc0329_read_flag = false;

// gc0329_DEV
#if 1
const uint8_t sensor_gc0329_init_talbe[][2] =
    {

        {0xfe, 0x80},
        {0xfc, 0x16},
        {0xfc, 0x16},
        {0xfe, 0x00},

        {0x70, 0x48},
        {0x73, 0x90},
        {0x74, 0x80},
        {0x75, 0x80},
        {0x76, 0x94}, // 80 jambo
        {0x77, 0x62},
        {0x78, 0x47},
        {0x79, 0x40},
        {0x03, 0x02},
        {0x04, 0x40},

        // ////////////////////analog////////////////////
        {0xfc, 0x16},
        {0x09, 0x00},
        {0x0a, 0x02},
        {0x0b, 0x00},
        {0x0c, 0x02},

        {0x17, FLIP_INIT_GC0329},
        {0x19, 0x05},
        {0x1b, 0x24},
        {0x1c, 0x04},
        // {0x1e, 0x08}, //08
        // {0x1f, 0x00}, // C8 //08
        // {0x20, 0x01}, //01

        {0x1e, 0x00},
        {0x1f, 0xc0},
        {0x20, 0x00},

        {0x21, 0x48},
        {0x22, 0xba},
        {0x23, 0x22},
        {0x24, 0x16},

        /* analog */
        // {0xfc, 0x16},
        // {0x0a, 0x00},
        // {0x0c, 0x00},
        // {0x17, 0x14},
        // {0x19, 0x05},
        // {0x1b, 0x24},
        // {0x1c, 0x04},
        // {0x1e, 0x00},
        // {0x1f, 0xc0},
        // {0x20, 0x00},
        // {0x21, 0x48},
        // {0x23, 0x22},
        // {0x24, 0x16},

        ////////////////////blk////////////////////
        {0x26, 0xf7}, // BLK
        {0x28, 0x7f}, // BLK limit
        {0x29, 0x00},
        {0x32, 0x00}, // 04 darkc
        {0x33, 0x20}, // blk ratio
        {0x34, 0x20},
        {0x35, 0x20},
        {0x36, 0x20},

        {0x3b, 0x04}, // manual offset
        {0x3c, 0x04},
        {0x3d, 0x04},
        {0x3e, 0x04},

        ////////////////////ISP BLOCK ENABLE////////////////////
        {0x40, 0xff},
        {0x41, 0x24}, //[5]skin detection
        {0x42, 0xfa}, // disable ABS
        // {0x46, 0x02},
        {0x46, 0x03},
        {0x4b, 0xca},
        {0x4d, 0x01},
        {0x4f, 0x01},
        {0x70, 0x48},

        ////////////////////DNDD////////////////////
        {0x80, 0x07}, // 0xe7 20140915
        {0x81, 0xc2}, // 0x22 20140915
        {0x82, 0x90}, // DN auto DNDD DEC DNDD //0e //55 jambo
        {0x83, 0x05},
        {0x87, 0x40}, // 0x4a  20140915

        ////////////////////INTPEE////////////////////
        {0x90, 0x8c}, // ac
        {0x92, 0x05},
        {0x94, 0x05},
        {0x95, 0x45}, // 0x44
        {0x96, 0x88},

        ////////////////////ASDE////////////////////
        {0xfe, 0x01},
        {0x18, 0x22},
        {0xfe, 0x00},
        {0x9c, 0x0a},
        {0xa0, 0xaf},
        {0xa2, 0xff},
        {0xa4, 0x30}, // 50 jambo
        {0xa5, 0x31},
        {0xa7, 0x35},

        ////////////////////RGB gamma////////////////////
        {0xfe, 0x00},
        {0xbf, 0x0b},
        {0xc0, 0x1d},
        {0xc1, 0x33},
        {0xc2, 0x49},
        {0xc3, 0x5d},
        {0xc4, 0x6e},
        {0xc5, 0x7c},
        {0xc6, 0x99},
        {0xc7, 0xaf},
        {0xc8, 0xc2},
        {0xc9, 0xd0},
        {0xca, 0xda},
        {0xcb, 0xe2},
        {0xcc, 0xe7},
        {0xcd, 0xf0},
        {0xce, 0xf7},
        {0xcf, 0xff},

        ////////////////////Y gamma////////////////////
        {0xfe, 0x00},
        {0x63, 0x00},
        {0x64, 0x06},
        {0x65, 0x0d},
        {0x66, 0x1b},
        {0x67, 0x2b},
        {0x68, 0x3d},
        {0x69, 0x50},
        {0x6a, 0x60},
        {0x6b, 0x80},
        {0x6c, 0xa0},
        {0x6d, 0xc0},
        {0x6e, 0xe0},
        {0x6f, 0xff},

        //////////////////CC///////////////////
        // main
        {0xfe, 0x00},
        {0xb3, 0x44},
        {0xb4, 0xfd},
        {0xb5, 0x02},
        {0xb6, 0xfa},
        {0xb7, 0x48},
        {0xb8, 0xf0},

        // crop
        {0x50, 0x01},

        ////////////////////YCP////////////////////
        {0xfe, 0x00},
        {0xd0, 0x40},
        {0xd1, 0x28},
        {0xd2, 0x28},
        {0xd3, 0x40}, // cont 0x40
        {0xd5, 0x00},
        {0xdd, 0x14},
        {0xde, 0x34},

        ////////////////////AEC////////////////////
        {0xfe, 0x01},
        {0x10, 0x40}, // before Gamma
        {0x11, 0x21}, //
        {0x12, 0x13}, // center weight *2
        {0x13, 0x50}, // 4 //4}, // AE Target
        {0x17, 0xa8}, // 88, 08, c8, a8
        {0x1a, 0x21},
        {0x20, 0x31}, // AEC stop margin
        {0x21, 0xc0},
        {0x22, 0x60},
        {0x3c, 0x50},
        {0x3d, 0x40},
        {0x3e, 0x45}, // read 3f for status

        ////////////////////AWB////////////////////
        // main
        {0xfe, 0x01},
        {0x06, 0x12},
        {0x07, 0x06},
        {0x08, 0x9c},
        {0x09, 0xee},
        {0x50, 0xfc},
        {0x51, 0x28},
        {0x52, 0x10},
        {0x53, 0x20},
        {0x54, 0x12},
        {0x55, 0x16},
        {0x56, 0x30},
        {0x58, 0x60},
        {0x59, 0x08},
        {0x5a, 0x02},
        {0x5b, 0x63},
        {0x5c, 0x35},
        {0x5d, 0x72},
        {0x5e, 0x11},
        {0x5f, 0x40},
        {0x60, 0x40},
        {0x61, 0xc8},
        {0x62, 0xa0},
        {0x63, 0x40},
        {0x64, 0x50},
        {0x65, 0x98},
        {0x66, 0xfa},
        {0x67, 0x80},
        {0x68, 0x60},
        {0x69, 0x90},
        {0x6a, 0x40},
        {0x6b, 0x39},
        {0x6c, 0x30},
        {0x6d, 0x60},
        {0x6e, 0x41},
        {0x70, 0x10},
        {0x71, 0x00},
        {0x72, 0x10},
        {0x73, 0x40},
        {0x80, 0x60},
        {0x81, 0x50},
        {0x82, 0x42},
        {0x83, 0x40},
        {0x84, 0x40},
        {0x85, 0x40},
        {0x74, 0x40},
        {0x75, 0x58},
        {0x76, 0x24},
        {0x77, 0x40},
        {0x78, 0x20},
        {0x79, 0x60},
        {0x7a, 0x58},
        {0x7b, 0x20},
        {0x7c, 0x30},
        {0x7d, 0x35},
        {0x7e, 0x10},
        {0x7f, 0x08},

        ///////////////////ABS///////////////////////
        {0x9c, 0x00},
        {0x9e, 0xc0},
        {0x9f, 0x40},

        ////////////////////CC-AWB////////////////////
        {0xd0, 0x00},
        {0xd2, 0x2c},
        {0xd3, 0x80},

        ///////////////////LSC //////////////////////

        {0xfe, 0x01},
        {0xc0, 0x0b},
        {0xc1, 0x07},
        {0xc2, 0x05},
        {0xc6, 0x0b},
        {0xc7, 0x07},
        {0xc8, 0x05},
        {0xba, 0x39},
        {0xbb, 0x24},
        {0xbc, 0x23},
        {0xb4, 0x39},
        {0xb5, 0x24},
        {0xb6, 0x23},
        {0xc3, 0x00},
        {0xc4, 0x00},
        {0xc5, 0x00},
        {0xc9, 0x00},
        {0xca, 0x00},
        {0xcb, 0x00},
        {0xbd, 0x2b},
        {0xbe, 0x00},
        {0xbf, 0x00},
        {0xb7, 0x09},
        {0xb8, 0x00},
        {0xb9, 0x00},
        {0xa8, 0x31},
        {0xa9, 0x23},
        {0xaa, 0x20},
        {0xab, 0x31},
        {0xac, 0x23},
        {0xad, 0x20},
        {0xae, 0x31},
        {0xaf, 0x23},
        {0xb0, 0x20},
        {0xb1, 0x31},
        {0xb2, 0x23},
        {0xb3, 0x20},
        {0xa4, 0x00},
        {0xa5, 0x00},
        {0xa6, 0x00},
        {0xa7, 0x00},
        {0xa1, 0x3c},
        {0xa2, 0x50},
        {0xfe, 0x00},

        //////////////////// flicker ///////////////////
        {0x05, 0x02},
        {0x06, 0x2c},
        {0x07, 0x00},
        {0x08, 0xb8},
        {0xfe, 0x01},
        {0x29, 0x00}, // anti-flicker step [11:8]
        {0x2a, 0x60}, // anti-flicker step [7:0]
        {0x2b, 0x02}, // exp level 0 , 0x14.28fps
        {0x2c, 0xa0},
        {0x2d, 0x03}, // exp level 1 , 0x12.50fps
        {0x2e, 0x00},
        {0x2f, 0x03}, // exp level 2 , 0x10.00fps
        {0x30, 0xc0},
        {0x31, 0x05}, // exp level 3 , 0x7.14fps
        {0x32, 0x40},
        {0xfe, 0x00},

        ////////////////////out ///////////////////

        {0x44, 0xa2},
        {0xf0, 0x07},
        {0xf1, 0x01},

};
#endif

#if 0
const uint8_t sensor_gc0329_init_talbe[][2] =
{
		{0xfe, 0x80},
		{0xfc, 0x16},
		{0xfc, 0x16},
		{0xfe, 0x00},

		{0x70, 0x48},
		{0x73, 0x90},
		{0x74, 0x80},
		{0x75, 0x80},
		{0x76, 0x94}, // 80 jambo
		{0x77, 0x62},
		{0x78, 0x47},
		{0x79, 0x40},

		{0x03, 0x02},
		{0x04, 0x40},

		////////////////////analog////////////////////
		{0xfc, 0x16},
		{0x09, 0x00},
		{0x0a, 0x02},
		{0x0b, 0x00},
		{0x0c, 0x02},
		{0x17, 0x14},
		{0x19, 0x05},
		{0x1b, 0x24},
		{0x1c, 0x04},
		{0x1e, 0x08},
		{0x1f, 0x08}, // C8
		{0x20, 0x01},
		{0x21, 0x48},
		{0x22, 0xba},
		{0x23, 0x22},
		{0x24, 0x16},

		////////////////////blk////////////////////
		{0x26, 0xf7}, // BLK
		{0x28, 0x7f}, // BLK limit
		{0x29, 0x00},
		{0x32, 0x00}, // 04 darkc
		{0x33, 0x20}, // blk ratio
		{0x34, 0x20},
		{0x35, 0x20},
		{0x36, 0x20},

		{0x3b, 0x04}, // manual offset
		{0x3c, 0x04},
		{0x3d, 0x04},
		{0x3e, 0x04},

		////////////////////ISP BLOCK ENABLE////////////////////
		{0x40, 0xff},
		{0x41, 0x24}, //[5]skin detection
		{0x42, 0xfa}, // disable ABS
		// {0x46, 0x02},
		{0x46, 0x03},
		{0x4b, 0xca},
		{0x4d, 0x01},
		{0x4f, 0x01},
		{0x70, 0x48},

		////////////////////DNDD////////////////////
		{0x80, 0x07}, // 0xe7 20140915
		{0x81, 0xc2}, // 0x22 20140915
		{0x82, 0x90}, // DN auto DNDD DEC DNDD //0e //55 jambo
		{0x83, 0x05},
		{0x87, 0x40}, // 0x4a  20140915

		////////////////////INTPEE////////////////////
		{0x90, 0x8c}, // ac
		{0x92, 0x05},
		{0x94, 0x05},
		{0x95, 0x45}, // 0x44
		{0x96, 0x88},

		////////////////////ASDE////////////////////
		{0xfe, 0x01},
		{0x18, 0x22},
		{0xfe, 0x00},
		{0x9c, 0x0a},
		{0xa0, 0xaf},
		{0xa2, 0xff},
		{0xa4, 0x30}, // 50 jambo
		{0xa5, 0x31},
		{0xa7, 0x35},

		////////////////////RGB gamma////////////////////
		{0xfe, 0x00},
		{0xbf, 0x0b},
		{0xc0, 0x1d},
		{0xc1, 0x33},
		{0xc2, 0x49},
		{0xc3, 0x5d},
		{0xc4, 0x6e},
		{0xc5, 0x7c},
		{0xc6, 0x99},
		{0xc7, 0xaf},
		{0xc8, 0xc2},
		{0xc9, 0xd0},
		{0xca, 0xda},
		{0xcb, 0xe2},
		{0xcc, 0xe7},
		{0xcd, 0xf0},
		{0xce, 0xf7},
		{0xcf, 0xff},

		////////////////////Y gamma////////////////////
		{0xfe, 0x00},
		{0x63, 0x00},
		{0x64, 0x06},
		{0x65, 0x0d},
		{0x66, 0x1b},
		{0x67, 0x2b},
		{0x68, 0x3d},
		{0x69, 0x50},
		{0x6a, 0x60},
		{0x6b, 0x80},
		{0x6c, 0xa0},
		{0x6d, 0xc0},
		{0x6e, 0xe0},
		{0x6f, 0xff},

//////////////////CC///////////////////
#if 1 // main
		{0xfe, 0x00},
		{0xb3, 0x44},
		{0xb4, 0xfd},
		{0xb5, 0x02},
		{0xb6, 0xfa},
		{0xb7, 0x48},
		{0xb8, 0xf0},
#else // sub
		{0xfe, 0x00},
		{0xb3, 0x42}, // 40
		{0xb4, 0xff}, // 00
		{0xb5, 0x06}, // 06
		{0xb6, 0xf0}, // 00
		{0xb7, 0x44}, // 40
		{0xb8, 0xf0}, // 00
#endif

		// crop
		{0x50, 0x01},

		////////////////////YCP////////////////////
		{0xfe, 0x00},

		{0xd0, 0x40},
		{0xd1, 0x28},
		{0xd2, 0x28},

		{0xd3, 0x40}, // cont 0x40
		{0xd5, 0x00},

		{0xdd, 0x14},
		{0xde, 0x34},

		////////////////////AEC////////////////////
		{0xfe, 0x01},
		{0x10, 0x40}, // before Gamma
		{0x11, 0x21}, //
		{0x12, 0x13}, // center weight *2
		{0x13, 0x50}, // 4 //4}, // AE Target
		{0x17, 0xa8}, // 88, 08, c8, a8
		{0x1a, 0x21},
		{0x20, 0x31}, // AEC stop margin
		{0x21, 0xc0},
		{0x22, 0x60},
		{0x3c, 0x50},
		{0x3d, 0x40},
		{0x3e, 0x45}, // read 3f for status

////////////////////AWB////////////////////
#if 1 // main
		{0xfe, 0x01},
		{0x06, 0x12},
		{0x07, 0x06},
		{0x08, 0x9c},
		{0x09, 0xee},
		{0x50, 0xfc},
		{0x51, 0x28},
		{0x52, 0x10},
		{0x53, 0x20},
		{0x54, 0x12},
		{0x55, 0x16},
		{0x56, 0x30},
		{0x58, 0x60},
		{0x59, 0x08},
		{0x5a, 0x02},
		{0x5b, 0x63},
		{0x5c, 0x35},
		{0x5d, 0x72},
		{0x5e, 0x11},
		{0x5f, 0x40},
		{0x60, 0x40},
		{0x61, 0xc8},
		{0x62, 0xa0},
		{0x63, 0x40},
		{0x64, 0x50},
		{0x65, 0x98},
		{0x66, 0xfa},
		{0x67, 0x80},
		{0x68, 0x60},
		{0x69, 0x90},
		{0x6a, 0x40},
		{0x6b, 0x39},
		{0x6c, 0x30},
		{0x6d, 0x60},
		{0x6e, 0x41},
		{0x70, 0x10},
		{0x71, 0x00},
		{0x72, 0x10},
		{0x73, 0x40},
		{0x80, 0x60},
		{0x81, 0x50},
		{0x82, 0x42},
		{0x83, 0x40},
		{0x84, 0x40},
		{0x85, 0x40},
		{0x74, 0x40},
		{0x75, 0x58},
		{0x76, 0x24},
		{0x77, 0x40},
		{0x78, 0x20},
		{0x79, 0x60},
		{0x7a, 0x58},
		{0x7b, 0x20},
		{0x7c, 0x30},
		{0x7d, 0x35},
		{0x7e, 0x10},
		{0x7f, 0x08},
#else // sub
		{0xfe, 0x01},
		{0x06, 0x16},
		{0x07, 0x06},
		{0x08, 0x98},
		{0x09, 0xee},
		{0x50, 0xfc},
		{0x51, 0x20},
		{0x52, 0x1b}, // 0b
		{0x53, 0x10}, // 20
		{0x54, 0x10}, // 40
		{0x55, 0x10},
		{0x56, 0x20},
		{0x57, 0xa0},
		{0x58, 0xa0},
		{0x59, 0x28},
		{0x5a, 0x02},
		{0x5b, 0x63},
		{0x5c, 0x04}, // 34
		{0x5d, 0x73},
		{0x5e, 0x11},
		{0x5f, 0x40},
		{0x60, 0x40},
		{0x61, 0xc8}, // d8 //c8
		{0x62, 0xa0}, /// 88 //A0
		{0x63, 0x40},
		{0x64, 0x40}, // 37
		{0x65, 0xd0},
		{0x66, 0xfa},
		{0x67, 0x70},
		{0x68, 0x58},
		{0x69, 0xa5}, // 85 jaambo
		{0x6a, 0x40},
		{0x6b, 0x39},
		{0x6c, 0x18},
		{0x6d, 0x28},
		{0x6e, 0x41},
		{0x70, 0x40},
		{0x71, 0x00},
		{0x72, 0x10},
		{0x73, 0x30}, // awb outdoor-th
		{0x80, 0x60},
		{0x81, 0x50},
		{0x82, 0x42},
		{0x83, 0x40},
		{0x84, 0x40},
		{0x85, 0x40},
		{0x86, 0x40},
		{0x87, 0x40},
		{0x88, 0xfe},
		{0x89, 0xa0},
		{0x74, 0x40},
		{0x75, 0x58},
		{0x76, 0x24},
		{0x77, 0x40},
		{0x78, 0x20},
		{0x79, 0x60},
		{0x7a, 0x58},
		{0x7b, 0x20},
		{0x7c, 0x30},
		{0x7d, 0x35},
		{0x7e, 0x10},
		{0x7f, 0x08},
#endif

		///////////////////ABS///////////////////////
		{0x9c, 0x00},
		{0x9e, 0xc0},
		{0x9f, 0x40},

		////////////////////CC-AWB////////////////////
		{0xd0, 0x00},
		{0xd2, 0x2c},
		{0xd3, 0x80},

		///////////////////LSC //////////////////////

		{0xfe, 0x01},
		{0xc0, 0x0b},
		{0xc1, 0x07},
		{0xc2, 0x05},
		{0xc6, 0x0b},
		{0xc7, 0x07},
		{0xc8, 0x05},
		{0xba, 0x39},
		{0xbb, 0x24},
		{0xbc, 0x23},
		{0xb4, 0x39},
		{0xb5, 0x24},
		{0xb6, 0x23},
		{0xc3, 0x00},
		{0xc4, 0x00},
		{0xc5, 0x00},
		{0xc9, 0x00},
		{0xca, 0x00},
		{0xcb, 0x00},
		{0xbd, 0x2b},
		{0xbe, 0x00},
		{0xbf, 0x00},
		{0xb7, 0x09},
		{0xb8, 0x00},
		{0xb9, 0x00},
		{0xa8, 0x31},
		{0xa9, 0x23},
		{0xaa, 0x20},
		{0xab, 0x31},
		{0xac, 0x23},
		{0xad, 0x20},
		{0xae, 0x31},
		{0xaf, 0x23},
		{0xb0, 0x20},
		{0xb1, 0x31},
		{0xb2, 0x23},
		{0xb3, 0x20},
		{0xa4, 0x00},
		{0xa5, 0x00},
		{0xa6, 0x00},
		{0xa7, 0x00},
		{0xa1, 0x3c},
		{0xa2, 0x50},
		{0xfe, 0x00},

		//////////////////// flicker ///////////////////
		// {0x05, 0x02},
		// {0x06, 0x2c},
		// {0x07, 0x00},
		// {0x08, 0xb8},
		// {0xfe, 0x01},
		// {0x29, 0x00}, // anti-flicker step [11:8]
		// {0x2a, 0x60}, // anti-flicker step [7:0]
		// {0x2b, 0x02}, // exp level 0 , 0x14.28fps
		// {0x2c, 0xa0},
		// {0x2d, 0x03}, // exp level 1 , 0x12.50fps
		// {0x2e, 0x00},
		// {0x2f, 0x03}, // exp level 2 , 0x10.00fps
		// {0x30, 0xc0},
		// {0x31, 0x05}, // exp level 3 , 0x7.14fps
		// {0x32, 0x40},
		// {0xfe, 0x00},

		////////////////////out ///////////////////

		{0x44, 0xa2},
		{0xf0, 0x07},
		{0xf1, 0x01},
#endif

const uint8_t sensor_gc0329_QVGA_320_240_talbe[][2] =
    {
        // subsample mode
        {0xFE, 0x00},
        {0x4b, 0xca},

        {0x50, 0x01},
        {0x51, 0x00},
        {0x52, 0x00},
        {0x53, 0x00},
        {0x54, 0x00},
        {0x55, 0x00},
        {0x56, 0xf0},
        {0x57, 0x01},
        {0x58, 0x40},

        {0x59, 0x22},
        {0x5a, 0x03},
        {0x5b, 0x00},
        {0x5c, 0x00},
        {0x5d, 0x00},
        {0x5e, 0x00},
        {0x5f, 0x00},
        {0x60, 0x00},
        {0x61, 0x00},
        {0x62, 0x00},

};

const uint8_t sensor_gc0329_VGA_640_480_talbe[][2] =
    {
#if 0
		{0xfe, 0x80},
		{0xfc, 0x16},
		{0xfc, 0x16},
		{0xfe, 0x00},

		{0x70, 0x48},
		{0x73, 0x90},
		{0x74, 0x80},
		{0x75, 0x80},
		{0x76, 0x94}, // 80 jambo
		{0x77, 0x62},
		{0x78, 0x47},
		{0x79, 0x40},
		{0x03, 0x02},
		{0x04, 0x40},

		////////////////////analog////////////////////
		{0xfc, 0x16},
		{0x09, 0x00},
		{0x0a, 0x02},
		{0x0b, 0x00},
		{0x0c, 0x02},
		{0x17, 0x14},
		{0x19, 0x05},
		{0x1b, 0x24},
		{0x1c, 0x04},
		{0x1e, 0x08},
		{0x1f, 0x08}, // C8
		{0x20, 0x01},
		{0x21, 0x48},
		{0x22, 0xba},
		{0x23, 0x22},
		{0x24, 0x16},

		/* analog */
		{0xfc, 0x16},
		{0x0a, 0x00},
		{0x0c, 0x00},
		{0x17, 0x14},
		{0x19, 0x05},
		{0x1b, 0x24},
		{0x1c, 0x04},
		{0x1e, 0x00},
		{0x1f, 0xc0},
		{0x20, 0x00},
		{0x21, 0x48},
		{0x23, 0x22},
		{0x24, 0x16},

		////////////////////blk////////////////////
		{0x26, 0xf7}, // BLK
		{0x28, 0x7f}, // BLK limit
		{0x29, 0x00},
		{0x32, 0x00}, // 04 darkc
		{0x33, 0x20}, // blk ratio
		{0x34, 0x20},
		{0x35, 0x20},
		{0x36, 0x20},

		{0x3b, 0x04}, // manual offset
		{0x3c, 0x04},
		{0x3d, 0x04},
		{0x3e, 0x04},

		////////////////////ISP BLOCK ENABLE////////////////////
		{0x40, 0xff},
		{0x41, 0x24}, //[5]skin detection
		{0x42, 0xfa}, // disable ABS
		// {0x46, 0x02},
		{0x46, 0x03},
		{0x4b, 0xca},
		{0x4d, 0x01},
		{0x4f, 0x01},
		{0x70, 0x48},

		////////////////////DNDD////////////////////
		{0x80, 0x07}, // 0xe7 20140915
		{0x81, 0xc2}, // 0x22 20140915
		{0x82, 0x90}, // DN auto DNDD DEC DNDD //0e //55 jambo
		{0x83, 0x05},
		{0x87, 0x40}, // 0x4a  20140915

		////////////////////INTPEE////////////////////
		{0x90, 0x8c}, // ac
		{0x92, 0x05},
		{0x94, 0x05},
		{0x95, 0x45}, // 0x44
		{0x96, 0x88},

		////////////////////ASDE////////////////////
		{0xfe, 0x01},
		{0x18, 0x22},
		{0xfe, 0x00},
		{0x9c, 0x0a},
		{0xa0, 0xaf},
		{0xa2, 0xff},
		{0xa4, 0x30}, // 50 jambo
		{0xa5, 0x31},
		{0xa7, 0x35},

		////////////////////RGB gamma////////////////////
		{0xfe, 0x00},
		{0xbf, 0x0b},
		{0xc0, 0x1d},
		{0xc1, 0x33},
		{0xc2, 0x49},
		{0xc3, 0x5d},
		{0xc4, 0x6e},
		{0xc5, 0x7c},
		{0xc6, 0x99},
		{0xc7, 0xaf},
		{0xc8, 0xc2},
		{0xc9, 0xd0},
		{0xca, 0xda},
		{0xcb, 0xe2},
		{0xcc, 0xe7},
		{0xcd, 0xf0},
		{0xce, 0xf7},
		{0xcf, 0xff},

		////////////////////Y gamma////////////////////
		{0xfe, 0x00},
		{0x63, 0x00},
		{0x64, 0x06},
		{0x65, 0x0d},
		{0x66, 0x1b},
		{0x67, 0x2b},
		{0x68, 0x3d},
		{0x69, 0x50},
		{0x6a, 0x60},
		{0x6b, 0x80},
		{0x6c, 0xa0},
		{0x6d, 0xc0},
		{0x6e, 0xe0},
		{0x6f, 0xff},

//////////////////CC///////////////////
// main
		{0xfe, 0x00},
		{0xb3, 0x44},
		{0xb4, 0xfd},
		{0xb5, 0x02},
		{0xb6, 0xfa},
		{0xb7, 0x48},
		{0xb8, 0xf0},

		// crop
		{0x50, 0x01},


		////////////////////YCP////////////////////
		{0xfe, 0x00},
		{0xd0, 0x40},
		{0xd1, 0x28},
		{0xd2, 0x28},
		{0xd3, 0x40}, // cont 0x40
		{0xd5, 0x00},
		{0xdd, 0x14},
		{0xde, 0x34},

		////////////////////AEC////////////////////
		{0xfe, 0x01},
		{0x10, 0x40}, // before Gamma
		{0x11, 0x21}, //
		{0x12, 0x13}, // center weight *2
		{0x13, 0x50}, // 4 //4}, // AE Target
		{0x17, 0xa8}, // 88, 08, c8, a8
		{0x1a, 0x21},
		{0x20, 0x31}, // AEC stop margin
		{0x21, 0xc0},
		{0x22, 0x60},
		{0x3c, 0x50},
		{0x3d, 0x40},
		{0x3e, 0x45}, // read 3f for status

////////////////////AWB////////////////////
 // main
		{0xfe, 0x01},
		{0x06, 0x12},
		{0x07, 0x06},
		{0x08, 0x9c},
		{0x09, 0xee},
		{0x50, 0xfc},
		{0x51, 0x28},
		{0x52, 0x10},
		{0x53, 0x20},
		{0x54, 0x12},
		{0x55, 0x16},
		{0x56, 0x30},
		{0x58, 0x60},
		{0x59, 0x08},
		{0x5a, 0x02},
		{0x5b, 0x63},
		{0x5c, 0x35},
		{0x5d, 0x72},
		{0x5e, 0x11},
		{0x5f, 0x40},
		{0x60, 0x40},
		{0x61, 0xc8},
		{0x62, 0xa0},
		{0x63, 0x40},
		{0x64, 0x50},
		{0x65, 0x98},
		{0x66, 0xfa},
		{0x67, 0x80},
		{0x68, 0x60},
		{0x69, 0x90},
		{0x6a, 0x40},
		{0x6b, 0x39},
		{0x6c, 0x30},
		{0x6d, 0x60},
		{0x6e, 0x41},
		{0x70, 0x10},
		{0x71, 0x00},
		{0x72, 0x10},
		{0x73, 0x40},
		{0x80, 0x60},
		{0x81, 0x50},
		{0x82, 0x42},
		{0x83, 0x40},
		{0x84, 0x40},
		{0x85, 0x40},
		{0x74, 0x40},
		{0x75, 0x58},
		{0x76, 0x24},
		{0x77, 0x40},
		{0x78, 0x20},
		{0x79, 0x60},
		{0x7a, 0x58},
		{0x7b, 0x20},
		{0x7c, 0x30},
		{0x7d, 0x35},
		{0x7e, 0x10},
		{0x7f, 0x08},


		///////////////////ABS///////////////////////
		{0x9c, 0x00},
		{0x9e, 0xc0},
		{0x9f, 0x40},

		////////////////////CC-AWB////////////////////
		{0xd0, 0x00},
		{0xd2, 0x2c},
		{0xd3, 0x80},

		///////////////////LSC //////////////////////

		{0xfe, 0x01},
		{0xc0, 0x0b},
		{0xc1, 0x07},
		{0xc2, 0x05},
		{0xc6, 0x0b},
		{0xc7, 0x07},
		{0xc8, 0x05},
		{0xba, 0x39},
		{0xbb, 0x24},
		{0xbc, 0x23},
		{0xb4, 0x39},
		{0xb5, 0x24},
		{0xb6, 0x23},
		{0xc3, 0x00},
		{0xc4, 0x00},
		{0xc5, 0x00},
		{0xc9, 0x00},
		{0xca, 0x00},
		{0xcb, 0x00},
		{0xbd, 0x2b},
		{0xbe, 0x00},
		{0xbf, 0x00},
		{0xb7, 0x09},
		{0xb8, 0x00},
		{0xb9, 0x00},
		{0xa8, 0x31},
		{0xa9, 0x23},
		{0xaa, 0x20},
		{0xab, 0x31},
		{0xac, 0x23},
		{0xad, 0x20},
		{0xae, 0x31},
		{0xaf, 0x23},
		{0xb0, 0x20},
		{0xb1, 0x31},
		{0xb2, 0x23},
		{0xb3, 0x20},
		{0xa4, 0x00},
		{0xa5, 0x00},
		{0xa6, 0x00},
		{0xa7, 0x00},
		{0xa1, 0x3c},
		{0xa2, 0x50},
		{0xfe, 0x00},

		//////////////////// flicker ///////////////////
		{0x05, 0x02},
		{0x06, 0x2c},
		{0x07, 0x00},
		{0x08, 0xb8},
		{0xfe, 0x01},
		{0x29, 0x00}, // anti-flicker step [11:8]
		{0x2a, 0x60}, // anti-flicker step [7:0]
		{0x2b, 0x02}, // exp level 0 , 0x14.28fps
		{0x2c, 0xa0},
		{0x2d, 0x03}, // exp level 1 , 0x12.50fps
		{0x2e, 0x00},
		{0x2f, 0x03}, // exp level 2 , 0x10.00fps
		{0x30, 0xc0},
		{0x31, 0x05}, // exp level 3 , 0x7.14fps
		{0x32, 0x40},
		{0xfe, 0x00},

		////////////////////out ///////////////////

		{0x44, 0xa2},
		{0xf0, 0x07},
		{0xf1, 0x01},
#endif

};

const UINT8 sensor_gc0329_5pfs_talbe[][2] =
    {
        // all AEC_EXP_LEVEL_X set to 0xa3c = 2620
        {0xFE, 0x01}, // page p1

        {0x2B, 0x0a}, // AEC_EXP_LEVEL_0 [11:8]
        {0x2C, 0x3c}, // AEC_EXP_LEVEL_0 [7:0]

        {0x2D, 0x0a}, // AEC_EXP_LEVEL_1
        {0x2E, 0x3c},

        {0x2F, 0x0a}, // AEC_EXP_LEVEL_2
        {0x30, 0x3c},

        {0x31, 0x0a}, // AEC_EXP_LEVEL_3
        {0x32, 0x3c},
        {0xfe, 0x00},

        //{0x33,0x2a},  // AEC_EXP_MIN
        //{0x34,0x3c},
};

const UINT8 sensor_gc0329_10pfs_talbe[][2] =
    {
        // all AEC_EXP_LEVEL_X set to 0x51e = 1310
        {0xFE, 0x01}, // page p1

        {0x2B, 0x05}, // AEC_EXP_LEVEL_0 [11:8]
        {0x2C, 0x1e}, // AEC_EXP_LEVEL_0 [7:0]

        {0x2D, 0x05}, // AEC_EXP_LEVEL_1
        {0x2E, 0x1e},

        {0x2F, 0x05}, // AEC_EXP_LEVEL_2
        {0x30, 0x1e},

        {0x31, 0x05}, // AEC_EXP_LEVEL_3
        {0x32, 0x1e},
        {0xfe, 0x00},

        //{0x33,0x25},  // // AEC_EXP_MIN
        //{0x34,0x1e},
};

bool gc0329_detect(void)
{
    uint8_t data = 0;
    // return false;
    SENSOR_I2C_READ(0xfb, &data);

    LOGW("%s, id: 0x%02X\n", __func__, data);

    if (data == GC0329_CHIP_ID)
    {
        LOGW("%s success\n", __func__);
        return true;
    }

    return false;
}

void gc0329_read_register(uint8_t addr, uint8_t data)

{
    if (gc0329_read_flag)
    {
        if (addr == 0x4e)
        {
            return;
        }

        uint8_t value = 0;
        rtos_delay_milliseconds(2);
        SENSOR_I2C_READ(addr, &value);
        if (value != data)
        {
            LOGI("0x%02x, 0x%02x-0x%02x\r\n", addr, data, value);
        }
    }
}

int gc0329_init(void)

{
    uint32_t size = sizeof(sensor_gc0329_init_talbe) / 2, i;

    LOGI("%s\n", __func__);

    for (i = 0; i < size; i++)
    {
        SENSOR_I2C_WRITE(sensor_gc0329_init_talbe[i][0], sensor_gc0329_init_talbe[i][1]);

        gc0329_read_register(sensor_gc0329_init_talbe[i][0], sensor_gc0329_init_talbe[i][1]);
    }

    return 0;
}

int gc0329_set_ppi(media_ppi_t ppi)
{
    uint32_t size, i;
    int ret = -1;

    LOGI("%s\n", __func__);

    switch (ppi)
    {
    case PPI_320X240:
    {
        size = sizeof(sensor_gc0329_QVGA_320_240_talbe) / 2;

        for (i = 0; i < size; i++)
        {
            SENSOR_I2C_WRITE(sensor_gc0329_QVGA_320_240_talbe[i][0],
                             sensor_gc0329_QVGA_320_240_talbe[i][1]);

            gc0329_read_register(sensor_gc0329_QVGA_320_240_talbe[i][0],
                                 sensor_gc0329_QVGA_320_240_talbe[i][1]);
        }

        ret = 0;
    }
    break;

    case PPI_640X480:
    {

        size = sizeof(sensor_gc0329_VGA_640_480_talbe) / 2;
        for (i = 0; i < size; i++)
        {
            SENSOR_I2C_WRITE(sensor_gc0329_VGA_640_480_talbe[i][0],
                             sensor_gc0329_VGA_640_480_talbe[i][1]);

            gc0329_read_register(sensor_gc0329_VGA_640_480_talbe[i][0],
                                 sensor_gc0329_VGA_640_480_talbe[i][1]);
        }

        ret = 0;
    }
    break;

    case PPI_800X600:
    case PPI_1280X720:
    default:
        break;
    }

    return ret;
}

int gc0329_set_fps(frame_fps_t fps)
{
    uint32_t size, i;
    int ret = -1;

    LOGI("%s\n", __func__);

    switch (fps)
    {
    case FPS5:
    {
        size = sizeof(sensor_gc0329_5pfs_talbe) / 2;

        for (i = 0; i < size; i++)
        {
            SENSOR_I2C_WRITE(sensor_gc0329_5pfs_talbe[i][0],
                             sensor_gc0329_5pfs_talbe[i][1]);

            gc0329_read_register(sensor_gc0329_5pfs_talbe[i][0],
                                 sensor_gc0329_5pfs_talbe[i][1]);
        }

        ret = 0;
    }
    break;
    case FPS10:
    {
        size = sizeof(sensor_gc0329_10pfs_talbe) / 2;

        for (i = 0; i < size; i++)
        {
            SENSOR_I2C_WRITE(sensor_gc0329_10pfs_talbe[i][0],
                             sensor_gc0329_10pfs_talbe[i][1]);

            gc0329_read_register(sensor_gc0329_10pfs_talbe[i][0],
                                 sensor_gc0329_10pfs_talbe[i][1]);
        }

        ret = 0;
    }
    break;
    case FPS15:
        break;
    case FPS20:
        break;
    case FPS25:
        break;
    case FPS30:
        break;
    default:
        LOGI("default 20fps");
    }

    return ret;
}

int gc0329_reset(void)
{
    SENSOR_I2C_WRITE(0xFE, 0x80);
    return 0;
}

int gc0329_dump(media_ppi_t ppi)
{
    uint32_t size, i;
    int ret = -1;
    uint8_t value = 0;

    LOGI("%s\n", __func__);

    size = sizeof(sensor_gc0329_init_talbe) / 2;

    for (i = 0; i < size; i++)
    {
        SENSOR_I2C_READ(sensor_gc0329_init_talbe[i][0], &value);
        LOGI("[0x%02x, 0x%02x]\r\n", sensor_gc0329_init_talbe[i][0], value);
    }

    switch (ppi)
    {
    case PPI_320X240:
    {
        size = sizeof(sensor_gc0329_QVGA_320_240_talbe) / 2;

        for (i = 0; i < size; i++)
        {
            SENSOR_I2C_READ(sensor_gc0329_QVGA_320_240_talbe[i][0], (uint8_t *)&value);
            LOGI("[%02x, %02x]\r\n", sensor_gc0329_QVGA_320_240_talbe[i][0], value);
        }

        ret = 0;
    }
    break;

    case PPI_640X480:
    {
        size = sizeof(sensor_gc0329_VGA_640_480_talbe) / 2;

        for (i = 0; i < size; i++)
        {
            SENSOR_I2C_READ(sensor_gc0329_VGA_640_480_talbe[i][0], &value);
            LOGI("[%02x, %02x]\r\n", sensor_gc0329_VGA_640_480_talbe[i][0], value);
        }

        ret = 0;
    }
    break;

    case PPI_800X600:
    case PPI_1280X720:
    default:
        break;
    }

    ret = kNoErr;

    return ret;
}

void gc0329_read_enable(bool enable)
{
    gc0329_read_flag = enable;
}

const dvp_sensor_config_t dvp_sensor_gc0329 =
    {
        .name = "gc0329",
        .clk = MCLK_24M,
        .fmt = PIXEL_FMT_YUYV,
        .vsync = SYNC_HIGH_LEVEL,
        .hsync = SYNC_HIGH_LEVEL,
        /* default config */
        .def_ppi = PPI_640X480,
        .def_fps = FPS25,
        /* capability config */
        .fps_cap = FPS5 | FPS10 | FPS20 | FPS25 | FPS30,
        .ppi_cap = PPI_CAP_320X240 | PPI_CAP_320X480 | PPI_CAP_480X272 | PPI_CAP_640X480 | PPI_CAP_480X320,
        .id = ID_GC0329,
        .address = (GC0329_WRITE_ADDRESS >> 1),
        .init = gc0329_init,
        .detect = gc0329_detect,
        .set_ppi = gc0329_set_ppi,
        .set_fps = gc0329_set_fps,
        .power_down = gc0329_reset,
        .dump_register = gc0329_dump,
        .read_register = gc0329_read_enable,
};
