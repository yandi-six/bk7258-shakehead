// Copyright 2020-2021 Beken
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

#include <driver/int.h>
#include <os/mem.h>
#include <driver/gpio.h>
#include <driver/gpio_types.h>
#include <driver/jpeg_enc.h>
#include <driver/jpeg_enc_types.h>
#include <driver/dvp_camera.h>
#include <driver/dvp_camera_types.h>

#include <driver/i2c.h>

#include "dvp_sensor_devices.h"

#define GC2035_WRITE_ADDRESS (0x78)
#define GC2035_READ_ADDRESS (0x79)
#define GC2035_CHIP_ID (0x35)
#define FLIP_INIT_GC2035 0x14


#define TAG "gc2035"
#define LOGI(...) BK_LOGI(TAG, ##__VA_ARGS__)
#define LOGW(...) BK_LOGW(TAG, ##__VA_ARGS__)

#define SENSOR_I2C_READ(reg, value)                                         \
    do                                                                      \
    {                                                                       \
        dvp_camera_i2c_read_uint8((GC2035_WRITE_ADDRESS >> 1), reg, value); \
    } while (0)

#define SENSOR_I2C_WRITE(reg, value)                                         \
    do                                                                       \
    {                                                                        \
        dvp_camera_i2c_write_uint8((GC2035_WRITE_ADDRESS >> 1), reg, value); \
    } while (0)

bool gc2035_read_flag = false;

// gc2035_DEV
#if 1
const uint8_t sensor_gc2035_init_talbe[][2] =
    {

        {0xfe, 0x80},
        {0xfe, 0x80},
        {0xfe, 0x80},
        {0xfc, 0x06},
        {0xf9, 0xfe}, //[0] pll enable
        {0xfa, 0x00},
        {0xf6, 0x00},
        {0xf7, 0x17}, // pll enable
        {0xf8, 0x00},
        {0xfe, 0x00},
        {0x82, 0x00},
        {0xb3, 0x60},
        {0xb4, 0x40},
        {0xb5, 0x60},
        {0x03, 0x05},
        {0x04, 0x2e},

        // measure window
        {0xfe, 0x00},
        {0xec, 0x04},
        {0xed, 0x04},
        {0xee, 0x60},
        {0xef, 0x90},

        {0x0a, 0x00}, // row start
        {0x0c, 0x02}, // col start

        {0x0d, 0x04},
        {0x0e, 0xc0},
        {0x0f, 0x06}, // Window setting
        {0x10, 0x58}, //

        {0x17, 0x14}, //[0]mirror [1]flip
        {0x18, 0x0a}, // sdark 4 row in even frame??
        {0x19, 0x0a}, // AD pipe number

        {0x1a, 0x01}, // CISCTL mode4
        {0x1b, 0x48},
        {0x1e, 0x88}, // analog mode1 [7] tx-high en
        {0x1f, 0x0f}, // analog mode2

        {0x20, 0x05}, //[0]adclk mode  [1]rowclk_MODE [2]rsthigh_en
        {0x21, 0x0f}, //[3]txlow_en
        {0x22, 0xf0}, //[3:0]vref
        {0x23, 0xc3}, // f3//ADC_r
        {0x24, 0x16}, // pad drive

        //==============================aec
        // AEC
        {0xfe, 0x01},
        {0x09, 0x00},

        {0x11, 0x10},
        {0x47, 0x30},
        {0x0b, 0x90},
        {0x13, 0x80}, // 0x75
        {0x1f, 0xc0}, // addd
        {0x20, 0x50}, // add  0x60
        {0xfe, 0x00},
        {0xf7, 0x17}, // pll enable
        {0xf8, 0x00},
        {0x05, 0x01},
        {0x06, 0x18},
        {0x07, 0x00},
        {0x08, 0x48},
        {0xfe, 0x01},
        {0x27, 0x00},
        {0x28, 0x6a},
        {0x29, 0x03},
        {0x2a, 0x50}, // 8fps
        {0x2b, 0x04},
        {0x2c, 0xf8},
        {0x2d, 0x06},
        {0x2e, 0xa0}, // 6fps
        {0x3e, 0x40}, // 0x40
        {0xfe, 0x00},
        {0xb6, 0x03}, // AEC enable
        {0xfe, 0x00},

        ///////BLK
        {0x3f, 0x00}, // prc close???
        {0x40, 0xa7}, // a7 77
        {0x42, 0x7f},
        {0x43, 0x30}, // 0x30

        {0x5c, 0x08},
        //{0x6c  3a //manual_offset ,real B channel
        //{0x6d  3a//manual_offset ,real B channel
        //{0x6e  36//manual_offset ,real R channel
        //{0x6f  36//manual_offset ,real R channel
        {0x5e, 0x20},
        {0x5f, 0x20},
        {0x60, 0x20},
        {0x61, 0x20},
        {0x62, 0x20},
        {0x63, 0x20},
        {0x64, 0x20},
        {0x65, 0x20},
        {0x66, 0x20},
        {0x67, 0x20},
        {0x68, 0x20},
        {0x69, 0x20},

        /////crop//
        {0x90, 0x01}, // crop enable
        {0x95, 0x04}, // 1600x1200
        {0x96, 0xb0},
        {0x97, 0x06},
        {0x98, 0x40},

        {0xfe, 0x03},
        {0x42, 0x80},
        {0x43, 0x06}, // output buf width //buf widthÕâÒ»¿éµÄÅäÖÃ»¹ÐèÒªžãÇå³þ
        {0x41, 0x00}, // delay
        {0x40, 0x00}, // fifo half full trig
        {0x17, 0x01}, // wid mipi²¿·ÖµÄ·ÖÆµÊÇÎªÊ²ÃŽv£¿
        {0xfe, 0x00},

        {0x80, 0xff}, // block enable 0xff
        {0x81, 0x26}, // 38  //skin_Y 8c_debug

        {0x03, 0x05},
        {0x04, 0x2e},
        {0x84, 0x00}, // output put foramat
        {0x86, 0x03}, // sync plority
        {0x87, 0x80}, // middle gamma on
        {0x8b, 0xbc}, // debug modeÐèÒªžãÇå³þÒ»ÏÂ
        {0xa7, 0x80}, // B_channel_gain
        {0xa8, 0x80}, // B_channel_gain
        {0xb0, 0x80}, // globle gain
        {0xc0, 0x40},

#if 1
        // lsc,
        {0xfe, 0x01},
        {0xc2, 0x10}, // 0x1f
        {0xc3, 0x02}, // 0x07
        {0xc4, 0x03}, // 0x03
        {0xc8, 0x10}, // 10
        {0xc9, 0x0a}, // 0x0a
        {0xca, 0x08}, // 0x08
        {0xbc, 0x16}, //      3c
        {0xbd, 0x10}, // 0x1c
        {0xbe, 0x10}, // 0x1a
        {0xb6, 0x22}, //    0x30
        {0xb7, 0x18}, // 0x1c
        {0xb8, 0x15}, // 0x15
        {0xc5, 0x00},
        {0xc6, 0x00},
        {0xc7, 0x00},
        {0xcb, 0x00},
        {0xcc, 0x00},
        {0xcd, 0x00},
        {0xbf, 0x0a}, // 0x0c
        {0xc0, 0x01}, // 0x04
        {0xc1, 0x00},
        {0xb9, 0x00},
        {0xba, 0x00},
        {0xbb, 0x00},
        {0xaa, 0x00},
        {0xab, 0x02}, // 00
        {0xac, 0x00},
        {0xad, 0x00},
        {0xae, 0x00},
        {0xaf, 0x00},
        {0xb0, 0x00},
        {0xb1, 0x00},
        {0xb2, 0x00},
        {0xb3, 0x00},
        {0xb4, 0x02}, // 00
        {0xb5, 0x00},
        {0xd0, 0x01},
        {0xd2, 0x02}, // 00
        {0xd3, 0x00},
        {0xd8, 0x18},
        {0xda, 0x00},
        {0xdb, 0x04},
        {0xdc, 0x00},
        {0xde, 0x07}, // 0x07
        {0xdf, 0x00},
        {0xd4, 0x00},
        {0xd6, 0x00}, // 00
        {0xd7, 0x00},
        {0xa4, 0x20}, // 00
        {0xa5, 0x02}, // 00
        {0xa6, 0x04},
        {0xa7, 0x00},
        {0xa8, 0x20}, // 00
        {0xa9, 0x02}, // 00
        {0xa1, 0x80},
        {0xa2, 0x80},

        {0xfe, 0x02},
        {0xa4, 0x00},
        {0xfe, 0x00},

        {0xfe, 0x02},
        {0xc0, 0x01},
        {0xc1, 0x40}, // Green_cc
        {0xc2, 0xfc},
        {0xc3, 0x05},
        {0xc4, 0xec},
        {0xc5, 0x42},
        {0xc6, 0xf8},
        {0xc7, 0x40},
        {0xc8, 0xf8},
        {0xc9, 0x06},
        {0xca, 0xfd},
        {0xcb, 0x3e},
        {0xcc, 0xf3},
        {0xcd, 0x36},
        {0xce, 0xf6},
        {0xcf, 0x04},
        {0xe3, 0x0c},
        {0xe4, 0x44},
        {0xe5, 0xe5},
        {0xfe, 0x00},
        {0xfe, 0x00},
        // awb
        {0xfe, 0x01},
        {0x4f, 0x00},
        {0x4d, 0x10}, ////////////////10
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0x20}, ///////////////20
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0x30}, //////////////////30
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x02}, // d65
        {0x4e, 0x04},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0x40}, //////////////////////40
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00}, // cwf
        {0x4e, 0x08}, // cwf
        {0x4e, 0x04},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0x50}, //////////////////50
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x10}, // tl84
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0x60}, /////////////////60
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0x70}, ///////////////////70
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x20}, // a
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0x80}, /////////////////////80
        {0x4e, 0x00}, // H
        {0x4e, 0x40}, // h
        {0x4e, 0x00}, // A
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0x90}, //////////////////////90
        {0x4e, 0x00}, // h
        {0x4e, 0x40},
        {0x4e, 0x40},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0xa0}, /////////////////a0
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0xb0}, //////////////////////////////////b0
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0xc0}, //////////////////////////////////c0
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0xd0}, ////////////////////////////d0
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0xe0}, /////////////////////////////////e0
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4d, 0xf0}, /////////////////////////////////f0
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4e, 0x00},
        {0x4f, 0x01},
#endif
        {0xfe, 0x01},
        {0x50, 0x88},
        {0x52, 0x40},
        {0x54, 0x60},
        {0x56, 0x06},
        {0x57, 0x20}, // pre adjust
        {0x58, 0x01},
        {0x5c, 0xf0},
        {0x5d, 0x40},
        {0x5b, 0x02}, // AWB_gain_delta
        {0x61, 0xaa}, // R/G stand
        {0x62, 0xaa}, // R/G stand
        {0x71, 0x00},
        {0x74, 0x10}, // AWB_C_max
        {0x77, 0x08}, // AWB_p2_x
        {0x78, 0xfd}, // AWB_p2_y
        {0x86, 0x30},
        {0x87, 0x00},
        {0x88, 0x06}, // 04
        {0x8a, 0x8a}, // awb move mode
        {0x89, 0x75},
        {0x84, 0x08}, // auto_window
        {0x8b, 0x00}, // awb compare luma
        {0x8d, 0x70}, // awb gain limit R
        {0x8e, 0x70}, // G
        {0x8f, 0xf4}, // B
        {0x5e, 0xa4},
        {0x5f, 0x60},
        {0x92, 0x58},
        {0xfe, 0x00},
        {0x82, 0x02}, // awb_en

        //{0xfe ,0xec}, luma_value
        {0xfe, 0x01},
        {0x1e, 0xf1},
        {0x9c, 0x00}, // add abs slope 0x02
        {0x21, 0xbf},
        {0xfe, 0x02},
        {0xa5, 0x60}, // lsc_th //40
        {0xa2, 0xc0}, // lsc_dec_slope 0xa0
        {0xa3, 0x30}, // when total gain is bigger than the value, enter dark light mode  0x20 added
        {0xa4, 0x00}, // add
        {0xa6, 0x50}, // dd_th
        {0xa7, 0x80}, // ot_th   30
        {0xab, 0x31}, //[0]b_dn_effect_dark_inc_or_dec
        {0x88, 0x15}, //[5:0]b_base
        {0xa9, 0x6c}, //[7:4] ASDE_DN_b_slope_high  0x6c 0x6f

        {0xb0, 0x66}, // 6edge effect slope 0x66 0x88 0x99

        {0xb3, 0x70}, // saturation dec slope  //0x70   0x40
        {0xb4, 0x32}, // 0x32 0x42
        {0x8c, 0xf6}, //[2]b_in_dark_inc
        {0x89, 0x03}, // dn_c_weight 0x03

        {0xde, 0xb8}, // b6[7]asde_autogray [3:0]auto_gray_value  0xb9 0xb8  0xb9
        {0x38, 0x06}, // 0aasde_autogray_slope 0x08 0x05 0x06 0x0a
        {0x39, 0x50}, // 50asde_autogray_threshold  0x50     0x30

        {0xfe, 0x00},
        {0x81, 0x24}, // 0x26
        {0x87, 0x90}, //[5:4]first_dn_en first_dd_en  enable 0x80 0xb0

        {0xfe, 0x02},
        {0x83, 0x00}, //[6]green_bks_auto [5]gobal_green_bks
        {0x84, 0x45}, // RB offset
        {0xd1, 0x38}, // saturation_cb  0x3a
        {0xd2, 0x38}, // saturation_Cr  0x38
        {0xd3, 0x30},
        {0xdc, 0x30},
        {0xdd, 0xb8}, // edge_sa_g,b
        {0xfe, 0x00},
        {0xad, 0x80}, // 80
        {0xae, 0x7d}, // 80
        {0xaf, 0x80},

        // gmma-curve4-low strech
        {0xfe, 0x02},
        {0x15, 0x05},
        {0x16, 0x0b},
        {0x17, 0x10},
        {0x18, 0x16},
        {0x19, 0x24},
        {0x1a, 0x32},
        {0x1b, 0x42},
        {0x1c, 0x4e},
        {0x1d, 0x64},
        {0x1e, 0x76},
        {0x1f, 0x86},
        {0x20, 0x94},
        {0x21, 0x9f},
        {0x22, 0xb4},
        {0x23, 0xc3},
        {0x24, 0xce},
        {0x25, 0xd7},
        {0x26, 0xe3},
        {0x27, 0xec},
        {0x28, 0xf7},
        {0x29, 0xff},

        // y-gamma
        {0x2b, 0x00},
        {0x2c, 0x04},
        {0x2d, 0x09},
        {0x2e, 0x18},
        {0x2f, 0x27},
        {0x30, 0x37},
        {0x31, 0x49},
        {0x32, 0x5c},
        {0x33, 0x7e},
        {0x34, 0xa0},
        {0x35, 0xc0},
        {0x36, 0xe0},
        {0x37, 0xff},
        {0xfe, 0x00},

        {0xfe, 0x00},

        {0x82, 0xfe},
        // sleep  400
        {0xf2, 0x70},
        {0xf3, 0xff},
        {0xf4, 0x00},
        {0xf5, 0x30},
        {0xfe, 0x01},
        {0x0b, 0x90},
        {0x87, 0x00}, // 0x10
        {0xfe, 0x00},

        /////,0xup},date
        // ÈÈ?0x  },
        {0xfe, 0x02},
        {0xa6, 0x80}, // dd_th
        {0xa7, 0x60}, // ot_th //0x80
        {0xa9, 0x66}, // 6f[7:4] ASDE_DN_b_slope_high 0x68
        {0xb0, 0x88}, // edge effect slope 0x99
        {0x38, 0x08}, // asde_autogray_slope 0x08   0x0f  0x0a 0b
        {0x39, 0x50}, // asde_autogray_threshold  0x60
        {0xfe, 0x00},
        {0x87, 0x90}, //[5:4]first_dn_en first_dd_en      0x90

        {0xfe, 0x00},
        {0x90, 0x01},
        {0x95, 0x01},
        {0x96, 0xe0},
        {0x97, 0x02},
        {0x98, 0x80},
        {0xc8, 0x14},
        {0xf7, 0x0D},
        {0xf8, 0x83},
        {0xfa, 0x00}, // pll=4
        {0x05, 0x00},
        {0x06, 0xc4},
        {0x07, 0x00},
        {0x08, 0xae},
        {0xad, 0x80},
        {0xae, 0x7a},
        {0xaf, 0x7a},
        {0xfe, 0x01},
        {0x27, 0x00},
        {0x28, 0xe5},
        {0x29, 0x05},
        {0x2a, 0x5e}, // 18fps
        {0x2b, 0x07},
        {0x2c, 0x28}, // 12.5fps
        {0x2d, 0x0a},
        {0x2e, 0xbc}, // 8fps
        {0x3e, 0x40}, // exposure level
        {0xfe, 0x03},
        {0x42, 0x04},
        {0x43, 0x05}, // output buf width
        {0x41, 0x02}, // delay
        {0x40, 0x40}, // fifo half full trig
        {0x17, 0x00}, // widv is 0
        {0xfe, 0x00},
        {0xc8, 0x55},

};
#endif

const uint8_t sensor_gc2035_QVGA_320_240_talbe[][2] =
    {

};

const uint8_t sensor_gc2035_VGA_640_480_talbe[][2] =
    {

        {0xfe, 0x00},

        {0x0a, 0x00}, // row start
        {0x0c, 0x00}, // col start

        {0x0d, 0x04},
        {0x0e, 0xc0},
        {0x0f, 0x06}, // Window setting
        {0x10, 0x58}, //

        {0x90, 0x01},
        {0x94, 0x00},
        {0x95, 0x01},
        {0x96, 0xe0},
        {0x97, 0x02},
        {0x98, 0x80},
        {0xc8, 0x15},

        {0xfa, 0x00},

        {0xfe, 0x03},
        {0x42, 0x00},
        {0x43, 0x05}, // output buf width  280*2=500
        {0x41, 0x02}, // delay
        {0x40, 0x40}, // fifo half full trig
        {0x17, 0x00}, // widv is 0

        {0xfe, 0x00},
        {0xc8, 0x55},
        {0xb6, 0x03}, // aec on
};

bool gc2035_detect(void)
{
    uint8_t data = 0;
    // return false;
    SENSOR_I2C_READ(0xf1, &data);

    LOGW("%s, id: 0x%02X\n", __func__, data);

    if (data == GC2035_CHIP_ID)
    {
        LOGW("%s success\n", __func__);
        return true;
    }

    return false;
}

void gc2035_read_register(uint8_t addr, uint8_t data)

{
    if (gc2035_read_flag)
    {
        if (addr == 0x4e)
        {
            return;
        }

        uint8_t value = 0;
        rtos_delay_milliseconds(2);
        SENSOR_I2C_READ(addr, &value);
        if (value != data)
        {
            LOGI("0x%02x, 0x%02x-0x%02x\r\n", addr, data, value);
        }
    }
}

int gc2035_init(void)

{
    uint32_t size = sizeof(sensor_gc2035_init_talbe) / 2, i;

    LOGI("%s\n", __func__);

    for (i = 0; i < size; i++)
    {
        SENSOR_I2C_WRITE(sensor_gc2035_init_talbe[i][0], sensor_gc2035_init_talbe[i][1]);

        gc2035_read_register(sensor_gc2035_init_talbe[i][0], sensor_gc2035_init_talbe[i][1]);
    }

    return 0;
}

int gc2035_set_ppi(media_ppi_t ppi)
{
    uint32_t size, i;
    int ret = -1;

    LOGI("%s\n", __func__);

    switch (ppi)
    {
    case PPI_320X240:
    {
        size = sizeof(sensor_gc2035_QVGA_320_240_talbe) / 2;

        for (i = 0; i < size; i++)
        {
            SENSOR_I2C_WRITE(sensor_gc2035_QVGA_320_240_talbe[i][0],
                             sensor_gc2035_QVGA_320_240_talbe[i][1]);

            gc2035_read_register(sensor_gc2035_QVGA_320_240_talbe[i][0],
                                 sensor_gc2035_QVGA_320_240_talbe[i][1]);
        }

        ret = 0;
    }
    break;

    case PPI_640X480:
    {

        size = sizeof(sensor_gc2035_VGA_640_480_talbe) / 2;
        for (i = 0; i < size; i++)
        {
            SENSOR_I2C_WRITE(sensor_gc2035_VGA_640_480_talbe[i][0],
                             sensor_gc2035_VGA_640_480_talbe[i][1]);

            gc2035_read_register(sensor_gc2035_VGA_640_480_talbe[i][0],
                                 sensor_gc2035_VGA_640_480_talbe[i][1]);
        }

        ret = 0;
    }
    break;

    case PPI_800X600:
    case PPI_1280X720:
    default:
        break;
    }

    return ret;
}

int gc2035_set_fps(frame_fps_t fps)
{
    return 0;
}

int gc2035_reset(void)
{
    SENSOR_I2C_WRITE(0xFE, 0x80);
    return 0;
}

int gc2035_dump(media_ppi_t ppi)
{
    uint32_t size, i;
    int ret = -1;
    uint8_t value = 0;

    LOGI("%s\n", __func__);

    size = sizeof(sensor_gc2035_init_talbe) / 2;

    for (i = 0; i < size; i++)
    {
        SENSOR_I2C_READ(sensor_gc2035_init_talbe[i][0], &value);
        LOGI("[0x%02x, 0x%02x]\r\n", sensor_gc2035_init_talbe[i][0], value);
    }

    switch (ppi)
    {
    case PPI_320X240:
    {
        size = sizeof(sensor_gc2035_QVGA_320_240_talbe) / 2;

        for (i = 0; i < size; i++)
        {
            SENSOR_I2C_READ(sensor_gc2035_QVGA_320_240_talbe[i][0], (uint8_t *)&value);
            LOGI("[%02x, %02x]\r\n", sensor_gc2035_QVGA_320_240_talbe[i][0], value);
        }

        ret = 0;
    }
    break;

    case PPI_640X480:
    {
        size = sizeof(sensor_gc2035_VGA_640_480_talbe) / 2;

        for (i = 0; i < size; i++)
        {
            SENSOR_I2C_READ(sensor_gc2035_VGA_640_480_talbe[i][0], &value);
            LOGI("[%02x, %02x]\r\n", sensor_gc2035_VGA_640_480_talbe[i][0], value);
        }

        ret = 0;
    }
    break;

    case PPI_800X600:
    case PPI_1280X720:
    default:
        break;
    }

    ret = kNoErr;

    return ret;
}

void gc2035_read_enable(bool enable)
{
    gc2035_read_flag = enable;
}

const dvp_sensor_config_t dvp_sensor_gc2035 =
    {
        .name = "gc2035",
        .clk = MCLK_24M,
        .fmt = PIXEL_FMT_YUYV,
        .vsync = SYNC_HIGH_LEVEL,
        .hsync = SYNC_HIGH_LEVEL,
        /* default config */
        .def_ppi = PPI_640X480,
        .def_fps = FPS25,
        /* capability config */
        .fps_cap = FPS5 | FPS10 | FPS20 | FPS25 | FPS30,
        .ppi_cap = PPI_CAP_320X240 | PPI_CAP_320X480 | PPI_CAP_480X272 | PPI_CAP_640X480 | PPI_CAP_480X320,
        .id = ID_GC2035,
        .address = (GC2035_WRITE_ADDRESS >> 1),
        .init = gc2035_init,
        .detect = gc2035_detect,
        .set_ppi = gc2035_set_ppi,
        .set_fps = gc2035_set_fps,
        .power_down = gc2035_reset,
        .dump_register = gc2035_dump,
        .read_register = gc2035_read_enable,
};
